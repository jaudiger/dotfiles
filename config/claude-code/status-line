#!/usr/bin/env nu --stdin
#
# Copyright (c) Jérémy Audiger.
# All rights reserved.
#

def status_line [input: record]: nothing -> nothing {
    # Extract values
    let cost = $input.cost.total_cost_usd | into string --decimals 4
    let current_dir = $input.workspace.current_dir
    let project_dir = $input.workspace.project_dir

    # Build left side: project/current
    let left = if $project_dir == $current_dir {
        $current_dir | path basename
    } else {
        let project_name = $project_dir | path basename
        let rel_path = $current_dir | str replace $"($project_dir)/" ""
        $"($project_name)/($rel_path)"
    }
    let left = $"($left)"

    # Build right side
    let right = $"$($cost)"

    # Calculate padding
    let padding = (term size).columns - ($left | str length) - ($right | str length) - 2
    let padding = if $padding < 3 {
        3
    } else if $padding > 80 {
        80
    } else {
        $padding
    }

    # Output: cyan left, green right
    let spaces = "" | fill --character " " --width $padding
    print -n $"(ansi cyan)($left)(ansi reset)($spaces)(ansi green)($right)(ansi reset)"
}

# Status line function for Claude Code UI
def main [
    ...args: any # Additional arguments
]: nothing -> nothing {
    # Read and parse JSON from stdin
    let input = $in | from json

    status_line $input
}
